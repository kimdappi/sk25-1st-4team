import streamlit as st
import pandas as pd
import pickle


def update_database():
    try:

        pkl_path = "../data/danawa_final.pkl"
    
        
        # ğŸ’¡ ë°ì´í„° ë³´ê°•: 20ëŒ€~80ëŒ€ / ìŠ¹ìš©, ìŠ¹í•© ëª¨ë“  ì¡°ê±´ì— 3ê°œì”© ì¶”ì²œ
        data_list = []
        ages = ["20ëŒ€", "30ëŒ€", "40ëŒ€", "50ëŒ€", "60ëŒ€", "70ëŒ€", "80ëŒ€"]
        # ìš”ì²­í•˜ì‹  ëŒ€ë¡œ 'ìŠ¹í•©' ì¶”ê°€
        types = ["ìŠ¹ìš©", "ìŠ¹í•©"]
        
        recommend_map = {
            "20ëŒ€": {"ìŠ¹ìš©": ["ì•„ë°˜ë–¼", "K5", "K3"], "ìŠ¹í•©": ["ìŠ¤íƒ€ë¦¬ì•„", "ì¹´ë‹ˆë°œ", "ì ë¼í‹°"]},
            "30ëŒ€": {"ìŠ¹ìš©": ["ì˜ë‚˜íƒ€", "K5", "ì•„ë°˜ë–¼"], "ìŠ¹í•©": ["ì¹´ë‹ˆë°œ", "ìŠ¤íƒ€ë¦¬ì•„", "ì›Œí¬ì“°ë£¨ë°´"]},
            "40ëŒ€": {"ìŠ¹ìš©": ["ê·¸ëœì €", "K8", "ì˜ë‚˜íƒ€"], "ìŠ¹í•©": ["ì¹´ë‹ˆë°œ", "ìŠ¤íƒ€ë¦¬ì•„", "ë§ˆìŠ¤í„°"]},
            "50ëŒ€": {"ìŠ¹ìš©": ["ê·¸ëœì €", "ì œë„¤ì‹œìŠ¤ G80", "K8"], "ìŠ¹í•©": ["ì¹´ë‹ˆë°œ", "ìŠ¤íƒ€ë¦¬ì•„", "ìŠ¤íƒ€ë ‰ìŠ¤"]},
            "60ëŒ€": {"ìŠ¹ìš©": ["ì œë„¤ì‹œìŠ¤ G80", "ê·¸ëœì €", "K9"], "ìŠ¹í•©": ["ì¹´ë‹ˆë°œ", "ìŠ¤íƒ€ë¦¬ì•„", "í¬í„°"]},
            "70ëŒ€": {"ìŠ¹ìš©": ["ì œë„¤ì‹œìŠ¤ G90", "ê·¸ëœì €", "ì œë„¤ì‹œìŠ¤ G80"], "ìŠ¹í•©": ["ìŠ¤íƒ€ë¦¬ì•„", "ì¹´ë‹ˆë°œ", "ë§ˆìŠ¤í„°"]},
            "80ëŒ€": {"ìŠ¹ìš©": ["ì œë„¤ì‹œìŠ¤ G90", "ê·¸ëœì €", "K9"], "ìŠ¹í•©": ["ìŠ¤íƒ€ë¦¬ì•„", "ì¹´ë‹ˆë°œ", "ì ë¼í‹°"]}
        }

        prices = {"ì•„ë°˜ë–¼": 2100, "K5": 2800, "K3": 1800, "ì˜ë‚˜íƒ€": 2800, "ê·¸ëœì €": 3900, "K8": 3400,
                  "ì œë„¤ì‹œìŠ¤ G80": 6100, "ì œë„¤ì‹œìŠ¤ G90": 9600, "K9": 6000, "ì¹´ë‹ˆë°œ": 3500, "ìŠ¤íƒ€ë¦¬ì•„": 3200,
                  "ì ë¼í‹°": 6500, "ë§ˆìŠ¤í„°": 4200, "ìŠ¤íƒ€ë ‰ìŠ¤": 2800, "í¬í„°": 2000, "ì›Œí¬ì“°ë£¨ë°´": 3100}

        for age in ages:
            for t in types:
                models = recommend_map[age][t]
                for i, model in enumerate(models):
                    data_list.append({
                        "ì—°ë ¹ëŒ€": age, "ì„±ë³„": "ì „ì²´", "ìˆœìœ„": i+1, 
                        "ëª¨ë¸ëª…": model, "ì°¨ì¢…": t, "ì ìœ ìœ¨": f"{45-(i*12)}%",
                        "ê°€ê²©": prices.get(model, 3000),
                        "ì œì¡°ì‚¬": "ì œë„¤ì‹œìŠ¤" if "ì œë„¤ì‹œìŠ¤" in model else ("ê¸°ì•„" if model in ["K5", "K3", "K8", "K9", "ì¹´ë‹ˆë°œ"] else "í˜„ëŒ€")
                    })
        
        final_df = pd.DataFrame(data_list)
        final_df.to_csv("final_filter_data.csv", index=False, encoding='utf-8')
        return True
    except Exception as e:
        st.error(f"ì˜¤ë¥˜: {e}")
        return False
